generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String                 @id @default(uuid())
  email                 String                 @unique
  name                  String
  microsoftId           String?                @unique @map("microsoft_id")
  avatarUrl             String?                @map("avatar_url")
  role                  Role                   @default(USER)
  isActive              Boolean                @default(true) @map("is_active")
  settings              String?                @db.Text
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  defaultCurrency       String                 @default("COP") @map("default_currency")
  password              String?
  theme                 String                 @default("light")
  accountTransfers      AccountTransfer[]
  bankAccounts          BankAccount[]
  budgets               Budget[]
  categories            Category[]
  creditCards           CreditCard[]
  debts                 Debt[]
  checklistItems        ChecklistItem[]
  notifications         Notification[]
  paymentReminders      PaymentReminder[]
  receipts              Receipt[]
  recurringTransactions RecurringTransaction[]
  savings               Saving[]
  savingsGoals          SavingsGoal[]
  createdTransactions   Transaction[]          @relation("CreatedBy")
  transactions          Transaction[]

  @@map("users")
}

model Transaction {
  id                  String               @id @default(uuid())
  userId              String               @map("user_id")
  type                TransactionType
  amount              Decimal              @db.Decimal(12, 2)
  currency            String               @default("COP") @db.VarChar(3)
  categoryId          String               @map("category_id")
  description         String               @db.Text
  date                DateTime             @db.Date
  receiptUrl          String?              @map("receipt_url")
  isRecurring         Boolean              @default(false) @map("is_recurring")
  recurringPattern    String?              @map("recurring_pattern") @db.Text
  metadata            String?              @db.Text
  syncedToSharepoint  Boolean              @default(false) @map("synced_to_sharepoint")
  sharepointRowId     String?              @map("sharepoint_row_id")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  createdBy           String?              @map("created_by")
  accountId           String?              @map("account_id")
  tags                String?              @db.Text
  checklistCompletion ChecklistCompletion?
  account             BankAccount?         @relation(fields: [accountId], references: [id])
  category            Category             @relation(fields: [categoryId], references: [id])
  creator             User?                @relation("CreatedBy", fields: [createdBy], references: [id])
  user                User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([accountId])
  @@index([categoryId])
  @@index([date])
  @@index([type])
  @@index([createdBy], map: "transactions_created_by_idx")
  @@map("transactions")
}

model Category {
  id               String            @id @default(uuid())
  userId           String?           @map("user_id")
  name             String
  type             TransactionType
  color            String
  icon             String
  isDefault        Boolean           @default(false) @map("is_default")
  createdAt        DateTime          @default(now()) @map("created_at")
  budgets          Budget[]
  user             User?             @relation(fields: [userId], references: [id], onDelete: Cascade)
  checklistItems   ChecklistItem[]
  paymentReminders PaymentReminder[]
  transactions     Transaction[]

  @@index([userId])
  @@map("categories")
}

model Budget {
  id         String    @id @default(uuid())
  userId     String    @map("user_id")
  categoryId String    @map("category_id")
  amount     Decimal   @db.Decimal(12, 2)
  period     String    @default("MONTHLY")
  startDate  DateTime  @map("start_date") @db.Date
  endDate    DateTime? @map("end_date") @db.Date
  isActive   Boolean   @default(true) @map("is_active")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  category   Category  @relation(fields: [categoryId], references: [id])
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([categoryId])
  @@map("budgets")
}

model SavingsGoal {
  id            String    @id @default(uuid())
  userId        String    @map("user_id")
  name          String
  targetAmount  Decimal   @map("target_amount") @db.Decimal(12, 2)
  currentAmount Decimal   @default(0.00) @map("current_amount") @db.Decimal(12, 2)
  deadline      DateTime? @db.Date
  isCompleted   Boolean   @default(false) @map("is_completed")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("savings_goals")
}

model PaymentReminder {
  id           String    @id @default(uuid())
  userId       String    @map("user_id")
  name         String
  amount       Decimal   @db.Decimal(12, 2)
  categoryId   String    @map("category_id")
  dueDay       Int       @map("due_day")
  isRecurring  Boolean   @default(true) @map("is_recurring")
  isPaid       Boolean   @default(false) @map("is_paid")
  lastPaidDate DateTime? @map("last_paid_date") @db.Date
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  category     Category  @relation(fields: [categoryId], references: [id])
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([categoryId])
  @@map("payment_reminders")
}

model BankAccount {
  id           String        @id @default(uuid())
  userId       String        @map("user_id")
  name         String
  type         String
  balance      Decimal       @default(0.00) @db.Decimal(12, 2)
  currency     String        @default("COP") @db.VarChar(3)
  isActive     Boolean       @default(true) @map("is_active")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@index([userId])
  @@map("bank_accounts")
}

model ChecklistItem {
  id          String                @id @default(uuid())
  userId      String                @map("user_id")
  name        String
  amount      Decimal               @db.Decimal(12, 2)
  categoryId  String                @map("category_id")
  dueDay      Int                   @map("due_day")
  isActive    Boolean               @default(true) @map("is_active")
  createdAt   DateTime              @default(now()) @map("created_at")
  deletedAt   DateTime?             @map("deleted_at")
  completions ChecklistCompletion[]
  category    Category              @relation(fields: [categoryId], references: [id])
  user        User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([categoryId], map: "monthly_checklist_category_id_idx")
  @@map("monthly_checklist")
}

model ChecklistCompletion {
  id              String        @id @default(uuid())
  checklistItemId String        @map("checklist_item_id")
  transactionId   String?       @unique @map("transaction_id")
  month           DateTime      @db.Date
  isCompleted     Boolean       @default(false) @map("is_completed")
  completedAt     DateTime?     @map("completed_at")
  checklistItem   ChecklistItem @relation(fields: [checklistItemId], references: [id], onDelete: Cascade)
  transaction     Transaction?  @relation(fields: [transactionId], references: [id])

  @@index([checklistItemId])
  @@index([month])
  @@map("checklist_completions")
}

model Receipt {
  id                String        @id @default(uuid())
  userId            String        @map("user_id")
  transactionId     String?       @map("transaction_id")
  imageUrl          String        @map("image_url")
  ocrData           String?       @map("ocr_data") @db.Text
  extractedAmount   Decimal?      @map("extracted_amount") @db.Decimal(12, 2)
  extractedDate     DateTime?     @map("extracted_date") @db.Date
  extractedMerchant String?       @map("extracted_merchant")
  confidenceScore   Float?        @map("confidence_score")
  status            ReceiptStatus @default(PENDING)
  createdAt         DateTime      @default(now()) @map("created_at")
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@map("receipts")
}

model SharepointSyncLog {
  id              String     @id @default(uuid())
  userId          String     @map("user_id")
  syncType        SyncType   @map("sync_type")
  status          SyncStatus
  recordsAffected Int        @map("records_affected")
  errorMessage    String?    @map("error_message") @db.Text
  createdAt       DateTime   @default(now()) @map("created_at")

  @@index([userId])
  @@index([createdAt])
  @@map("sharepoint_sync_log")
}

model Debt {
  id          String        @id @default(uuid())
  userId      String        @map("user_id")
  creditor    String
  totalAmount Decimal       @db.Decimal(12, 2)
  paidAmount  Decimal       @default(0.00) @db.Decimal(12, 2)
  description String?
  dueDate     DateTime?     @map("due_date")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  payments    DebtPayment[]
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("debts")
}

model DebtPayment {
  id          String   @id @default(uuid())
  debtId      String   @map("debt_id")
  amount      Decimal  @db.Decimal(12, 2)
  description String?
  paymentDate DateTime @default(now()) @map("payment_date")
  createdAt   DateTime @default(now()) @map("created_at")
  debt        Debt     @relation(fields: [debtId], references: [id], onDelete: Cascade)

  @@index([debtId])
  @@index([paymentDate])
  @@map("debt_payments")
}

model Saving {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  name      String
  amount    Decimal  @db.Decimal(12, 2)
  purpose   String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("savings")
}

model Notification {
  id        String               @id @default(uuid())
  userId    String               @map("user_id")
  type      NotificationType
  title     String
  message   String               @db.Text
  icon      String               @default("?")
  link      String?
  priority  NotificationPriority @default(NORMAL)
  isRead    Boolean              @default(false) @map("is_read")
  readAt    DateTime?            @map("read_at")
  createdAt DateTime             @default(now()) @map("created_at")
  user      User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

model CreditCard {
  id              String                  @id @default(uuid())
  userId          String                  @map("user_id")
  name            String
  lastFourDigits  String?                 @map("last_four_digits") @db.VarChar(4)
  brand           CardBrand               @default(OTHER)
  creditLimit     Decimal                 @map("credit_limit") @db.Decimal(12, 2)
  currentBalance  Decimal                 @default(0.00) @map("current_balance") @db.Decimal(12, 2)
  availableCredit Decimal                 @map("available_credit") @db.Decimal(12, 2)
  cutOffDay       Int                     @map("cut_off_day")
  paymentDueDay   Int                     @map("payment_due_day")
  minimumPayment  Decimal?                @map("minimum_payment") @db.Decimal(12, 2)
  interestRate    Decimal?                @map("interest_rate") @db.Decimal(5, 2)
  currency        String                  @default("COP") @db.VarChar(3)
  color           String                  @default("#1e40af")
  isActive        Boolean                 @default(true) @map("is_active")
  createdAt       DateTime                @default(now()) @map("created_at")
  updatedAt       DateTime                @updatedAt @map("updated_at")
  payments        CreditCardPayment[]
  transactions    CreditCardTransaction[]
  user            User                    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("credit_cards")
}

model CreditCardTransaction {
  id                 String     @id @default(uuid())
  creditCardId       String     @map("credit_card_id")
  amount             Decimal    @db.Decimal(12, 2)
  description        String
  merchant           String?
  categoryId         String?    @map("category_id")
  installments       Int        @default(1)
  currentInstallment Int        @default(1) @map("current_installment")
  installmentAmount  Decimal?   @map("installment_amount") @db.Decimal(12, 2)
  transactionDate    DateTime   @map("transaction_date") @db.Date
  statementDate      DateTime?  @map("statement_date") @db.Date
  isRecurring        Boolean    @default(false) @map("is_recurring")
  isPending          Boolean    @default(true) @map("is_pending")
  createdAt          DateTime   @default(now()) @map("created_at")
  creditCard         CreditCard @relation(fields: [creditCardId], references: [id], onDelete: Cascade)

  @@index([creditCardId])
  @@index([transactionDate])
  @@map("credit_card_transactions")
}

model CreditCardPayment {
  id           String      @id @default(uuid())
  creditCardId String      @map("credit_card_id")
  amount       Decimal     @db.Decimal(12, 2)
  paymentType  PaymentType @default(FULL) @map("payment_type")
  paymentDate  DateTime    @map("payment_date") @db.Date
  description  String?
  createdAt    DateTime    @default(now()) @map("created_at")
  creditCard   CreditCard  @relation(fields: [creditCardId], references: [id], onDelete: Cascade)

  @@index([creditCardId])
  @@index([paymentDate])
  @@map("credit_card_payments")
}

model RecurringTransaction {
  id            String              @id @default(uuid())
  userId        String              @map("user_id")
  type          TransactionType
  amount        Decimal             @db.Decimal(12, 2)
  categoryId    String              @map("category_id")
  description   String
  frequency     RecurrenceFrequency
  dayOfMonth    Int?                @map("day_of_month")
  dayOfWeek     Int?                @map("day_of_week")
  startDate     DateTime            @map("start_date") @db.Date
  endDate       DateTime?           @map("end_date") @db.Date
  lastExecuted  DateTime?           @map("last_executed") @db.Date
  nextExecution DateTime            @map("next_execution") @db.Date
  isActive      Boolean             @default(true) @map("is_active")
  autoCreate    Boolean             @default(false) @map("auto_create")
  createdAt     DateTime            @default(now()) @map("created_at")
  updatedAt     DateTime            @updatedAt @map("updated_at")
  user          User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([nextExecution])
  @@map("recurring_transactions")
}

model AccountTransfer {
  id            String   @id @default(uuid())
  userId        String   @map("user_id")
  fromAccountId String   @map("from_account_id")
  toAccountId   String   @map("to_account_id")
  amount        Decimal  @db.Decimal(12, 2)
  description   String?
  transferDate  DateTime @map("transfer_date") @db.Date
  createdAt     DateTime @default(now()) @map("created_at")
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([transferDate])
  @@map("account_transfers")
}

model AppChecklist_tasks {
  id                                                                    Int                          @id @default(autoincrement())
  title                                                                 String                       @db.VarChar(255)
  description                                                           String?                      @db.Text
  assigned_to                                                           Int
  assigned_by                                                           Int
  is_completed                                                          Boolean?                     @default(false)
  completed_at                                                          DateTime?                    @db.Timestamp(6)
  due_date                                                              DateTime?                    @db.Date
  priority                                                              AppChecklist_tasks_priority? @default(medium)
  created_at                                                            DateTime?                    @default(now()) @db.Timestamp(6)
  updated_at                                                            DateTime?                    @default(now()) @db.Timestamp(6)
  AppChecklist_users_AppChecklist_tasks_assigned_toToAppChecklist_users AppChecklist_users           @relation("AppChecklist_tasks_assigned_toToAppChecklist_users", fields: [assigned_to], references: [id], onUpdate: Restrict, map: "AppChecklist_tasks_ibfk_1")
  AppChecklist_users_AppChecklist_tasks_assigned_byToAppChecklist_users AppChecklist_users           @relation("AppChecklist_tasks_assigned_byToAppChecklist_users", fields: [assigned_by], references: [id], onUpdate: Restrict, map: "AppChecklist_tasks_ibfk_2")

  @@index([assigned_by], map: "assigned_by")
  @@index([assigned_to], map: "assigned_to")
}

model AppChecklist_users {
  id                                                                    Int                  @id @default(autoincrement())
  name                                                                  String               @db.VarChar(100)
  avatar_emoji                                                          String?              @default("❤️") @db.VarChar(10)
  created_at                                                            DateTime?            @default(now()) @db.Timestamp(6)
  AppChecklist_tasks_AppChecklist_tasks_assigned_toToAppChecklist_users AppChecklist_tasks[] @relation("AppChecklist_tasks_assigned_toToAppChecklist_users")
  AppChecklist_tasks_AppChecklist_tasks_assigned_byToAppChecklist_users AppChecklist_tasks[] @relation("AppChecklist_tasks_assigned_byToAppChecklist_users")
}

enum Role {
  ADMIN
  USER
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum ReceiptStatus {
  PENDING
  APPROVED
  REJECTED
}

enum SyncType {
  PUSH
  PULL
}

enum SyncStatus {
  SUCCESS
  ERROR
}

enum NotificationType {
  BUDGET_ALERT
  PAYMENT_REMINDER
  GOAL_COMPLETED
  DEBT_DUE
  UNUSUAL_SPENDING
  ACHIEVEMENT
  SYSTEM
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum CardBrand {
  VISA
  MASTERCARD
  AMERICAN_EXPRESS
  DINERS
  OTHER
}

enum PaymentType {
  FULL
  MINIMUM
  PARTIAL
}

enum RecurrenceFrequency {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum AppChecklist_tasks_priority {
  low
  medium
  high
}
